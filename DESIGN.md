
## BitTorrent cover

The design of how to hide behind bittorrent was created with the following goal in mind:
make it look as genuine as possible in order to blend in with all other bittorrent
connections.

Bit-smuggler never makes any network connections by itself. All connections
between a bit-smuggler client and server are tunneled through connections
created by the bittorrent clients living on both sides.

Both the client and server each run exactly one instance of a bittorrent client.

The server runs a bittorrent client that presents itself as a peer holding a 
set of of incomplete files (contact-files). 

The client knows the server descriptor:

```haskell
data ServerDescriptor = ServerDescriptor {
    serverAddr :: IP 
  , contactFiles :: [ContactFile]
  , serverPubKey :: Key
}
```

The  bit-smuggler's client bittorrent client holds incomplete copies of the contact files as well.
The incomplete copies of a contact file F owned by both the client and the server
are not the same so that it allows the 2 peers to exchange pieces back-and-forth.
(each peer needs some pieces that the other has and has some pieces that the other doesn't)

The bit-smuggler client picks at random a contact file to download and instructs its
bittorrent client to go for it. the bittorrent client will eventually connect to its
peer (the bitsmuggler server) and a bitsmuggler connection can be established using that
data exchange as a tunnel. 

When the file being exchanged is exhausted (no more data flows back and forth
- all data that could be exchanged was exchanged),
the client requests to download another contact file at random.

The server constantly replenishes its exhausted contact files. it polls its bittorrent
client to see what files are exhausted, it deletes them and assigns 

### Contact files

Contact files are currently random data files of various lengths generated with
a pseudorandom-generator from a single integer seed. 
both client and server generate these files ahead of time knowing the integer seed and the length, before establishing a connection.


They can be real files but that involes pulling the data of the respective file
(eg. Pirates of the Carribean) ahead of time.

This is considered good enough since, as discussed in the README.md, it doesn't make it
easier to detect in real-time and bit-smuggler will be detected anyway on a slow path.

File names are manually created but can be random generated perhaps using 
markov chains (further work).

Partial copies are generated by randomly selecting pieceCount / 2 pieces and zeroing them
out (removing the data). This means that each peer will get from the other roughly
1/4 of a file. So to exhaust a 4GB file, roughly 1GB will flow in both directions.

## Crypto

We are using symmetric key cryptography.

We are *assuming* the client **knows** the  public key of the server and sends 
its own  public key in plain but transformed so it looks like a random string
with djb's [elligator](http://cr.yp.to/elligator/elligator-20130527.pdf)

then they both derive a shared secret and use that to encrypt the rest of the 
communication. (see the crypto code and a diagram [here](https://github.com/danoctavian/bit-smuggler/blob/master/BitSmuggler/src/Network/BitSmuggler/Crypto.hs) )

